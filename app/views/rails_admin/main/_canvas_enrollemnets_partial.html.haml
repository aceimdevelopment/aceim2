- unless course_period.id_canvas.blank?
	- begin
		- course_id = course_period.id_canvas
		- require 'canvas-api'
		- canvas = MyCanvas.connect
		-# enrollments = canvas.get("/api/v1/courses/#{course_id}/enrollments", {per_page: 50, role: "StudentEnrollment"})
		- course = canvas.get("/api/v1/courses/#{course_id}")
		- sections = canvas.get("/api/v1/courses/#{course_id}/sections")

		%h3= course['name'] if course
		- if sections
			%h4
				= "#{sections.length} Secciones:"
				.label.label-info= "#{sections.map{|sec| sec['name']}.to_sentence}"
		=# sections.last #{}"#{sections.length} Secciones: #{sections.map{|sec| sec['name']}.to_sentence}" if sections

		- k = 1
		%table.table.table-striped.table-sm.table-hover.table-responsive-md.mt-3
			%thead
				%tr
					%th #
					%th Id_Canvas
					%th Nombres
					%th Email
					%th Sec
					%th Status Aceim
			- sections.each do |sec| 
				- enrollments = canvas.get("/api/v1/sections/#{sec['id']}/enrollments", {per_page: 50, role: "StudentEnrollment"})
				-# enrollments = canvas.get("/api/v1/courses/#{course_id}/sections/#{sec}/students")#, {per_page: 50, role: "StudentEnrollment"})
				- if enrollments
					- begin
						%tbody
							- enrollments.each do |enroll| 
								%tr
									%td= k
									%td= enroll['user_id']
									%td= enroll['user']['name'].to_s.split.map{|w| w.capitalize}.join(" ")
									- email = enroll['user']['login_id']
									%td= email
									%td= "#{sec['name']} (#{sec['id']})"
									- user = User.where(email: email).first
									%td 
										- if user and es = user.student
											- enrolled = es.academic_records.joins({section: :course_period}).where("course_periods.id = #{course_period.id}").first
											- if enrolled
												.label.label-info= enrolled.inscription_status.capitalize if enrolled.inscription_status
											- else
												.label.label-warning No inscrito en el curso

												= link_to "/admin/student/#{es.id}", {type: 'button', class: 'tooltip-btn label label-info', title: 'Ir al detalle', data: {toggle: 'tooltip', placement: 'bottom'}} do
													%span.fa.fa-search-plus
										- else
											.label.label-danger Usuario no encontrado

								- k+=1
					- end while enrollments.more? and enrollments = enrollments.next_page!
	- rescue Exception => e
		:javascript
			console.log(`No se pudo cargar el recurso en Canvas: #{e}`)
			alert(`No se pudo cargar el recurso en Canvas: #{e.to_s}`)